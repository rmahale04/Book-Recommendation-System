<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Books</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/table_styles.css') }}">
  <style>
    .page-header-wrapper {
      padding: 20px 30px 10px;
    }

    .page-header {
      text-align: left;
    }

    .main-layout {
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 20px;
      padding: 0 30px 30px;
    }

    /* FILTER PANEL */
    .filter-panel {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      height: fit-content;
    }

    .filter-panel h3 {
      margin-bottom: 15px;
      font-size: 18px;
    }

    .filter-group {
      margin-bottom: 15px;
    }

    .filter-group label {
      font-size: 13px;
      font-weight: 600;
      display: block;
      margin-bottom: 5px;
    }

    .filter-group select {
      width: 100%;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .filter-group small {
      font-size: 11px;
      color: #666;
    }

    .filter-btn {
      width: 100%;
      padding: 10px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .clear-btn {
      display: block;
      text-align: center;
      margin-top: 8px;
      font-size: 13px;
      color: #555;
    }

    /* RESPONSIVE */
    @media (max-width: 900px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  {% include "nav_page.html" %}

  <!-- <h1 class="page-header">Book Collection</h1> -->
    <div class="page-header-wrapper">
      <h1 class="page-header">Book Collection</h1>
    </div>

    <div class="main-layout">

  <!-- FILTER SIDEBAR -->
  <aside class="filter-panel">
    <h3>Filter Books</h3>

    <form method="GET" action="{{ url_for('view_books') }}">

      <!-- Year -->
      <div class="filter-group">
        <label>Published Year</label>
        <select name="year">
          <option value="">All</option>
          {% for y in range(2025, 1900, -1) %}
            <option value="{{ y }}" {% if request.args.get('year') == y|string %}selected{% endif %}>
              {{ y }}
            </option>
          {% endfor %}
        </select>
      </div>
      <!-- <div class="filter-group">
        <label>Published Year Range</label>

        <div style="display: flex; gap: 8px;">
          <select name="year_from">
            <option value="">From</option>
            {% for y in range(2025, 1900, -1) %}
              <option value="{{ y }}"
                {% if request.args.get('year_from') == y|string %}selected{% endif %}>
                {{ y }}
              </option>
            {% endfor %}
          </select>

          <select name="year_to">
            <option value="">To</option>
            {% for y in range(2025, 1900, -1) %}
              <option value="{{ y }}"
                {% if request.args.get('year_to') == y|string %}selected{% endif %}>
                {{ y }}
              </option>
            {% endfor %}
          </select>
        </div>

        <small>Select a publication year range</small>
      </div> -->


      <!-- Language -->
      <div class="filter-group">
        <label>Language</label>
        <select name="language">
          <option value="">All</option>
          <option value="English">English</option>
          <option value="Hindi">Hindi</option>
          <option value="Gujarati">Gujarati</option>
          <option value="Marathi">Marathi</option>
        </select>
      </div>

      <!-- Genres -->
      <div class="filter-group">
        <label>Genres</label>

        <div style="max-height: 180px; overflow-y: auto; border: 1px solid #ddd; padding: 8px; border-radius: 5px;">
          {% for genre in all_genres %}
            <label style="display: block; font-size: 13px; margin-bottom: 4px;">
              <input
                type="checkbox"
                name="genres"
                value="{{ genre }}"
                {% if genre in request.args.getlist('genres') %}checked{% endif %}
              >
              {{ genre }}
            </label>
          {% endfor %}
        </div>
        <small>You can select multiple genres</small>
      </div>

      <!-- gender of author -->
      <div class="filter-group">
        <label>Author Gender</label>
        <select name="author_gender">
          <option value="">All</option>
          <option value="Male" {% if request.args.get('author_gender') == 'Male' %}selected{% endif %}>Male</option>
          <option value="Female" {% if request.args.get('author_gender') == 'Female' %}selected{% endif %}>Female</option>
          <option value="Other" {% if request.args.get('author_gender') == 'Other' %}selected{% endif %}>Other</option>
        </select>
      </div>



      <!-- Rating -->
      <div class="filter-group">
        <label>Minimum Rating</label>
        <select name="rating">
          <option value="">All</option>
          <option value="4">4 â˜… & above</option>
          <option value="3">3 â˜… & above</option>
          <option value="2">2 â˜… & above</option>
          <option value="1">1 â˜… & above</option>
        </select>
      </div>

      <!-- Sort -->
      <div class="filter-group">
        <label>Sort By</label>
        <select name="sort">
          <option value="">Relevance</option>
          <option value="rating_desc">Rating (High â†’ Low)</option>
          <option value="rating_asc">Rating (Low â†’ High)</option>
          <option value="year_desc">Year (Newest)</option>
          <option value="year_asc">Year (Oldest)</option>
        </select>
      </div>

      <button type="submit" class="filter-btn">Apply Filters</button>
      <a href="{{ url_for('view_books', q=suggestion) }}" class="clear-btn">
        Search for "{{ suggestion }}"
      </a>

    </form>
  </aside>

  <!-- BOOK GRID -->
  <section class="book-content">
    {% if search_query %}
      <p style="margin-bottom: 10px; color: #2e2d2d;">
        Showing results for <strong>{{ search_query }}</strong>
        <small>(ranked by relevance)</small>
      </p>
    {% endif %}

    {% if suggestion and suggestion.lower() != search_query.lower() %}
      <p style="margin-bottom: 10px;">
        Did you mean <strong>{{ suggestion }}</strong>?
      </p>
    {% endif %}
    
    <div class="book-grid">
      {% if books %}
        {% for book in books %}
          <a href="{{ url_for('book_details', book_id=book.book_id) }}" class="book-card">
            <div class="book-cover-container">
              <img src="{{ book.cover_image_url or url_for('static', filename='images/no_cover.png') }}"
                   class="book-cover">
            </div>
            <div class="book-title">{{ book.title }}</div>
            <div class="book-author">{{ book.author or 'Unknown Author' }}</div>
            <div class="book-meta">{{ book.published_year or 'N/A' }}</div>
          </a>
        {% endfor %}
      {% else %}
        <div class="empty-state">No books found</div>
      {% endif %}
    </div>
  </section>

</div>


  <!-- <div class="container">

    {% if search_query %}
      <p style="margin-bottom: 15px; color: #2e2d2d;">
        Showing results for <strong>{{ search_query }}</strong>
        <small style="color:#020202;">(ranked by relevance)</small>
      </p>
    {% endif %}

    {% if suggestion and suggestion.lower() != search_query.lower() %}
      <p style="color: #2e2d2d; margin-bottom: 10px;">
          Did you mean <strong>{{ suggestion }}</strong>?
      </p>
    {% endif %}


    <div class="book-grid">
      {% if books %}
        {% for book in books %}
        <a href="{{ url_for('book_details', book_id=book.book_id) }}" class="book-card">

          <div class="book-cover-container">
            <img
              src="{{ book.cover_image_url or url_for('static', filename='images/no_cover.png') }}"
              alt="{{ book.title }}"
              class="book-cover">
          </div>

          <div class="book-title">{{ book.title }}</div>

          <div class="book-author">
            {{ book.author or 'Unknown Author' }}
          </div>

          {% if book.series %}
            <div class="book-series">ðŸ“– {{ book.series }}</div>
          {% else %}
            <div class="book-series" style="opacity: 0;">â€”</div>
          {% endif %}

          <div class="book-meta">
            <div>{{ book.published_year or 'N/A' }}</div>
          </div>

        </a>
        {% endfor %}
      {% else %}
        <div class="empty-state">
          {% if search_query %}
            No books found for "<strong>{{ search_query }}</strong>"
          {% else %}
            No books found in your collection yet
          {% endif %}
        </div>
      {% endif %}
    </div>

  </div> -->

</body>
</html>
